# GSP315 - **Perform Foundational Infrastructure Tasks in Google Cloud: laborat√≥rio com desafio**



# Definir vari√°veis do laborat√≥rio

### Ative o Google Cloud Shell

:


A defini√ß√£o da vari√°vel √© feita atrav√©s do comando export . Copie o valor de cada credencial e cole ap√≥s o sinal de igual, substituindo o texto **em vermelho**  na vari√°vel correspondente.

Definindo a vari√°vel do **Bucket**.

------------
export BUCKET_NAME=BUCKET_NAME
---------

Copie o valor do comando export acima ‚¨ÜÔ∏è cole no Cloud Shell e pressione Enter ‚Ü≤ para executar.

Repita a opera√ß√£o acima para as demais vari√°veis.

Definindo o nome da vari√°vel Topic Name (Cloud **Pub/Sub)**
---------
export TOPIC_NAME=**TOPIC_NAME**
---------

Definindo o nome da vari√°vel **Cloud Function Name**
---------
export CLOUDFUNCTION_NAME=**CLOUD_FUNCTION_NAME**
---------

Definindo o nome da vari√°vel  **Username2** 
---------
export USERNAME2=**USERNAME2**
---------

Definindo o nome da vari√°vel **Project_ID**
---------
export PROJECT_ID=**PROJECT_ID**
---------


# **Tarefa 1: crie um bucket**

Voc√™ precisa criar um bucket com o nome¬†BUCKET_NAME¬†para armazenar as fotos.

### 1.1 Criar Bucket

Para criar o bucket use o comando¬†`[gsutil mb](https://cloud.google.com/storage/docs/gsutil/commands/mb)` (Make Bucket) utilizando a vari√°vel $BUCKET_NAME que teve seu valor definido no in√≠cio deste laborat√≥rio.

Aten√ß√£o com a grafia , verificar letras mai√∫sculas e min√∫sculas

A linha de comando ter√° a estrutura definida abaixo, em que:

- **`$BUCKET_NAME`**¬†√© a vari√°vel que cont√©m o nome que voc√™ quer dar ao bucket, sujeito a¬†[requisitos de nomenclatura](https://cloud.google.com/storage/docs/naming-buckets). Por exemplo,¬†`my-bucket`.

---------
	gsutil mb gs://$**BUCKET_NAME**
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar


**Listar os buckets em um projeto**


---------
gcloud alpha storage ls --project=$**PROJECT_ID**
---------

¬†**`$PROJECT_ID`**¬†√© a vari√°vel que contem o ID do projeto em que os buckets est√£o.


# Tarefa 2: crie um t√≥pico do Pub/Sub

### 2.1 Crie um t√≥pico do Pub/Sub

Crie um t√≥pico do Pub/Sub com o nome¬† (TOPIC_NAME)¬†para que a fun√ß√£o do Cloud envie mensagens.


A linha de comando ter√° a estrutura definida abaixo, em que:

- **`$TOPIC_NAME`**¬†√© a vari√°vel que cont√©m o nome que voc√™ quer dar ao t√≥pico.
---------
gcloud pubsub topics create $TOPIC_NAME
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar

### 2.2 Listar t√≥picos


---------
gcloud pubsub topics list
---------


### 2.3 Verificar Progresso


# Tarefa 3: crie a miniatura da fun√ß√£o do Cloud




---------
wget https://github.com/guys-in-the-cloud/cloud-skill-boosts/raw/main/Challenge-labs/Perform%20Foundational%20Infrastructure%20Tasks%20in%20Google%20Cloud:%20Challenge%20Lab/index.js
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar


### 3.2 Substituir vari√°vel

Devemos trocar o valor padr√£o que est√° no arquivo **index.js** pelo valor da vari√°vel do laborat√≥rio, para isso vamos substituir a vari√°vel REPLACE_WITH_YOUR_TOPIC ID pela vari√°vel TOPIC_NAME que cont√©m o valor do laborat√≥rio.
---------
sed -i "s/REPLACE_WITH_YOUR_TOPIC ID/$TOPIC_NAME/g" index.js
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar.


### 3.3 Utilizar o comando [wget](https://github.com/GoogleCloudPlatform/cloud-builders/blob/master/wget/README.md) para baixar o arquivo **Package.json**
---------
wget https://github.com/guys-in-the-cloud/cloud-skill-boosts/raw/main/Challenge-labs/Perform%20Foundational%20Infrastructure%20Tasks%20in%20Google%20Cloud:%20Challenge%20Lab/package.json
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar



### 3.4 Para criar uma Fun√ß√£o do Cloud ([Deploy)](https://cloud.google.com/sdk/gcloud/reference/deploy)

Ap√≥s baixar e configurar os arquivos, devemos criar um t√≥pico do Pub/Sub chamado¬†thumbnail substituindo¬†dentro do BUCKET_NAME que j√° foi criado:

---------
gcloud functions deploy $CLOUDFUNCTION_NAME \
    --entry-point thumbnail \
    --runtime nodejs14 \
    --trigger-bucket $BUCKET_NAME \
    --region us-east1
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar

O comando pode demorar v√°rios minutos para ser executado, aguarde a sua conclus√£o, para prosseguir.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/c3b6c499-4c01-4a09-82e9-ca7cc7f199d8/Untitled.png)

üö® **Caso ocorra erro na execu√ß√£o**
---------
gcloud functions deploy $CLOUDFUNCTION_NAME \
--entry-point thumbnail \
--runtime **nodejs12** \
--trigger-bucket $BUCKET_NAME \
--region **us-east1**
---------

üö® Verifique no laborat√≥rio o nome da regi√£o (region) e a vers√£o do nodejs que est√£o especificados e substitua-os no c√≥digo acima e execute-o novamente.

### 3.5 **Fa√ßa upload de um objeto no seu bucket**


Agora fa√ßa upload de um objeto em um bucket.  √â necess√°rio fazer upload de uma imagem JPG ou PNG para o bucket. Ap√≥s a fun√ß√£o ser criada, confirmaremos a cria√ß√£o da miniatura.

Primeiro fa√ßa o download da imagem para uma inst√¢ncia tempor√°ria (map.jpg) no Cloud Shell.

O comando wget deve ser utilizado para realizar o download do arquivo 

---------
wget --output-document map.jpg https://storage.googleapis.com/cloud-training/gsp315/map.jpg
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar



Use o comando¬†`gsutil cp`¬†para copiar a imagem da inst√¢ncia tempor√°ria  em que voc√™ a salvou e envi√°-la para o novo bucket.
---------
gsutil cp map.jpg gs://$BUCKET_NAME
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar


### 3.6 Verificar Progresso



# **Tarefa 4: remova o engenheiro de nuvem anterior**



### 4.1 Remover acesso

Por seguran√ßa, remova o acesso do engenheiro de nuvem anterior ao projeto.
---------
gcloud projects remove-iam-policy-binding $DEVSHELL_PROJECT_ID \
    --member=user:$USERNAME2 --role=roles/viewer
---------

Copie o c√≥digo acima ‚¨ÜÔ∏è cole no Shell e pressione **Enter ‚Ü≤** para executar



### 4.2 Verificar Progresso
